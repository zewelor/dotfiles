#!/bin/bash

cd $(dirname $BASH_SOURCE)
BASE=$(pwd)

# Install symlinks via stow

function install_with_stow() {
  echo "Running stow with $@"
  local stow_command="stow -v $@"
  $stow_command -n

  if [ $? -ne 0 ]; then
    echo "Error running stow command: $stow_command"
    exit 1
  fi

  read -p "Do you want to apply the changes? [y/N] " -n 1 -r
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    # echo "Applying changes..."
    $stow_command
  fi
}

install_with_stow -t $HOME --ignore .config/atuin/config.toml .
install_with_stow -t $HOME -d prv .

# Atuin keeps updating file so lets link it manually
mkdir -p ~/.config/atuin/
ln -sfn $BASE/.config/atuin/config.toml ~/.config/atuin/config.toml

# SSH
mkdir -p ~/.ssh/config.d/

for ssh_config in $BASE/prv/ssh/config.d/*; do
  if [ ! -L ~/.ssh/config.d/$(basename $ssh_config) ]; then
    x ln -sfnvi $ssh_config ~/.ssh/config.d/
  fi
done

# Midnight Commander
mkdir -p ~/.mc/
curl -Ls https://raw.githubusercontent.com/peel/mc/master/solarized.ini > ~/.mc/solarized.ini

# VIM

# export GIT_SSL_NO_VERIFY=true
mkdir -p ~/.vim/autoload ~/.vim/undo ~/.vim/swapfiles ~/.vim/backupfiles
curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

vim +PlugInstall +qall
